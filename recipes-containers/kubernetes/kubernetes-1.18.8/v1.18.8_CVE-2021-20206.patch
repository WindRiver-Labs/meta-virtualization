From 407cdcbb78c8eceee1a26176cbf78968bbd0d1e3 Mon Sep 17 00:00:00 2001
From: Navid Shaikh <navids@vmware.com>
Date: Thu, 6 May 2021 15:41:08 +0530
Subject: [PATCH] Bump containernetworking/cni to v0.8.1

 Fix CVE-2021-20206
CVE: CVE-2021-20206
Upstream-Status: Backport [185f65fbddb5239666c0c67fb335589b7570f60c]
Signed-off-by: Sakib Sajal <sakib.sajal@windriver.com>
---
 go.mod                                                       | 4 ++--
 go.sum                                                       | 4 ++--
 vendor/github.com/containernetworking/cni/pkg/invoke/find.go | 5 +++++
 vendor/modules.txt                                           | 2 +-
 4 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/src/import/go.mod b/src/import/go.mod
index 65ad0c07aa0..4a6fd16000c 100644
--- a/src/import/go.mod
+++ b/src/import/go.mod
@@ -36,7 +36,7 @@ require (
 	github.com/containerd/console v0.0.0-20170925154832-84eeaae905fa // indirect
 	github.com/containerd/containerd v1.0.2 // indirect
 	github.com/containerd/typeurl v0.0.0-20190228175220-2a93cfde8c20 // indirect
-	github.com/containernetworking/cni v0.7.1
+	github.com/containernetworking/cni v0.8.1
 	github.com/coredns/corefile-migration v1.0.6
 	github.com/coreos/go-oidc v2.1.0+incompatible
 	github.com/coreos/go-systemd v0.0.0-20190321100706-95778dfbb74e
@@ -232,7 +232,7 @@ replace (
 	github.com/containerd/console => github.com/containerd/console v0.0.0-20170925154832-84eeaae905fa
 	github.com/containerd/containerd => github.com/containerd/containerd v1.0.2
 	github.com/containerd/typeurl => github.com/containerd/typeurl v0.0.0-20190228175220-2a93cfde8c20
-	github.com/containernetworking/cni => github.com/containernetworking/cni v0.7.1
+	github.com/containernetworking/cni => github.com/containernetworking/cni v0.8.1
 	github.com/coredns/corefile-migration => github.com/coredns/corefile-migration v1.0.6
 	github.com/coreos/etcd => github.com/coreos/etcd v3.3.10+incompatible
 	github.com/coreos/go-etcd => github.com/coreos/go-etcd v2.0.0+incompatible
diff --git a/src/import/go.sum b/src/import/go.sum
index 7a3ba6c00a1..638a30f9e5c 100644
--- a/src/import/go.sum
+++ b/src/import/go.sum
@@ -104,8 +104,8 @@ github.com/containerd/containerd v1.0.2 h1:AcqeeOunmUuo2CvPPtHMhWn7mi54clu+j9yqX
 github.com/containerd/containerd v1.0.2/go.mod h1:bC6axHOhabU15QhwfG7w5PipXdVtMXFTttgp+kVtyUA=
 github.com/containerd/typeurl v0.0.0-20190228175220-2a93cfde8c20 h1:14r0i3IeJj6zkNLigAJiv/TWSR8EY+pxIjv5tFiT+n8=
 github.com/containerd/typeurl v0.0.0-20190228175220-2a93cfde8c20/go.mod h1:Cm3kwCdlkCfMSHURc+r6fwoGH6/F1hH3S4sg0rLFWPc=
-github.com/containernetworking/cni v0.7.1 h1:fE3r16wpSEyaqY4Z4oFrLMmIGfBYIKpPrHK31EJ9FzE=
-github.com/containernetworking/cni v0.7.1/go.mod h1:LGwApLUm2FpoOfxTDEeq8T9ipbpZ61X79hmU3w8FmsY=
+github.com/containernetworking/cni v0.8.1 h1:7zpDnQ3T3s4ucOuJ/ZCLrYBxzkg0AELFfII3Epo9TmI=
+github.com/containernetworking/cni v0.8.1/go.mod h1:LGwApLUm2FpoOfxTDEeq8T9ipbpZ61X79hmU3w8FmsY=
 github.com/coredns/corefile-migration v1.0.6 h1:hB6vclp2g/KeXe9n1oz/PafgieUahsOYeHMQA+RJ4Hg=
 github.com/coredns/corefile-migration v1.0.6/go.mod h1:OFwBp/Wc9dJt5cAZzHWMNhK1r5L0p0jDwIBc6j8NC8E=
 github.com/coreos/etcd v3.3.10+incompatible h1:jFneRYjIvLMLhDLCzuTuU4rSJUjRplcJQ7pD7MnhC04=
diff --git a/src/import/vendor/github.com/containernetworking/cni/pkg/invoke/find.go b/src/import/vendor/github.com/containernetworking/cni/pkg/invoke/find.go
index e815404c859..e62029eb788 100644
--- a/src/import/vendor/github.com/containernetworking/cni/pkg/invoke/find.go
+++ b/src/import/vendor/github.com/containernetworking/cni/pkg/invoke/find.go
@@ -18,6 +18,7 @@ import (
 	"fmt"
 	"os"
 	"path/filepath"
+	"strings"
 )
 
 // FindInPath returns the full path of the plugin by searching in the provided path
@@ -26,6 +27,10 @@ func FindInPath(plugin string, paths []string) (string, error) {
 		return "", fmt.Errorf("no plugin name provided")
 	}
 
+	if strings.ContainsRune(plugin, os.PathSeparator) {
+		return "", fmt.Errorf("invalid plugin name: %s", plugin)
+	}
+
 	if len(paths) == 0 {
 		return "", fmt.Errorf("no paths provided")
 	}
diff --git a/src/import/vendor/modules.txt b/src/import/vendor/modules.txt
index cfa03c9ae7e..a3b2cd5a7c9 100644
--- a/src/import/vendor/modules.txt
+++ b/src/import/vendor/modules.txt
@@ -179,7 +179,7 @@ github.com/containerd/containerd/containers
 github.com/containerd/containerd/dialer
 github.com/containerd/containerd/errdefs
 github.com/containerd/containerd/namespaces
-# github.com/containernetworking/cni v0.7.1 => github.com/containernetworking/cni v0.7.1
+# github.com/containernetworking/cni v0.8.1 => github.com/containernetworking/cni v0.8.1
 github.com/containernetworking/cni/libcni
 github.com/containernetworking/cni/pkg/invoke
 github.com/containernetworking/cni/pkg/types
-- 
2.25.1

